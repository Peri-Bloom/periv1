<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="description" content="openEHR SMART App Launch and Service Discovery Framework (SMART)">
<meta name="keywords" content="JSON, REST, SMART, OAuth2, OIDC, Authentication, Authorization, Application, App">
<title>SMART on openEHR (SMART)</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_smart_on_openehr_smart">SMART on openEHR (SMART)</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_primary_author">Primary Author</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_trademarks">Trademarks</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_related_documents">1.2. Related Documents</a></li>
<li><a href="#_status">1.3. Status</a></li>
<li><a href="#_feedback">1.4. Feedback</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_background">2.1. Background</a></li>
<li><a href="#_glossary">2.2. Glossary</a></li>
<li><a href="#_why_smart_on_openehr">2.3. Why SMART on openEHR?</a></li>
</ul>
</li>
<li><a href="#_application_registration">3. Application Registration</a></li>
<li><a href="#_service_discovery">4. Service Discovery</a>
<ul class="sectlevel2">
<li><a href="#_background_2">4.1. Background</a></li>
<li><a href="#_authentication_endpoints">4.2. Authentication endpoints</a></li>
<li><a href="#_services">4.3. Services</a></li>
<li><a href="#_capabilities">4.4. Capabilities</a></li>
</ul>
</li>
<li><a href="#_authentication_authorization_and_scopes">5. Authentication, Authorization and Scopes</a>
<ul class="sectlevel2">
<li><a href="#_authentication">5.1. Authentication</a></li>
<li><a href="#_smart_authorization_flow">5.2. SMART Authorization Flow</a>
<ul class="sectlevel3">
<li><a href="#_context_selection">5.2.1. Context Selection</a></li>
<li><a href="#_embedded_iframe_launch">5.2.2. Embedded iFrame Launch</a></li>
</ul>
</li>
<li><a href="#_scopes_for_openehr_rest_api">5.3. Scopes for openEHR REST API</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="https://specifications.openehr.org/images/openEHR_logo_RGB.svg" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_smart_on_openehr_smart" class="sect0"><a class="anchor" href="#_smart_on_openehr_smart"></a>SMART on openEHR (SMART)</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification" target="_blank" rel="noopener">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: ITS-REST latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: DEVELOPMENT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: JSON, REST, SMART, OAuth2, OIDC, Authentication, Authorization, Application, App</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<object type="image/svg+xml" data="openehr_block_diagram.svg" width="60%"><span class="alt">openEHR components</span></object>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2023 - 2023 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="https://www.openehr.org" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit foundation, facilitating the sharing of health records by consumers and clinicians via open specifications, clinical models and open platform implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/ITS-REST/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="https://specifications.openehr.org" target="_blank" rel="noopener">specifications.openEHR.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record"><a class="anchor" href="#_amendment_record"></a>Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>ITS_REST Release (unreleased)</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECITS-69" target="_blank" rel="noopener">SPECITS-69</a>. Adding "SMART on openEHR" specifications.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Ramesh,<br>
S Iancu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>20 Aug 2023</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_author"><a class="anchor" href="#_primary_author"></a>Primary Author</h3>
<div class="ulist">
<ul>
<li>
<p>Sidharth Ramesh; Medblocks.</p>
</li>
<li>
<p>Sebastian Iancu; Architect, Code24, Netherlands</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>Contributors</h3>
<div class="paragraph">
<p>This specification has benefited from formal and informal input from the openEHR and wider health informatics community. The openEHR Foundation would like to recognise the following for their contributions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ian McNicoll MD, FreshEHR, UK</p>
</li>
<li>
<p>Bostjan Lah, Senior Architect, Better, Slovenia</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A significant part of the design ideas and content of this specification was adapted from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the SMART on FHIR protocol described by HL7 FHIR</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trademarks"><a class="anchor" href="#_trademarks"></a>Trademarks</h3>
<div class="ulist">
<ul>
<li>
<p>'openEHR' is a registered trademark of the openEHR Foundation</p>
</li>
<li>
<p>'FHIR' is a registered trademark of the Health Level Seven International (HL7)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document describes SMART protocol for an openEHR platform.</p>
</div>
<div class="paragraph">
<p>The intended audience includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standards bodies producing health informatics standards;</p>
</li>
<li>
<p>Solution vendors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_documents"><a class="anchor" href="#_related_documents"></a>1.2. Related Documents</h3>
<div class="paragraph">
<p>Prerequisite documents for reading this document include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html" target="_blank" rel="noopener">openEHR Architecture Overview</a></p>
</li>
<li>
<p><a href="https://specifications.openehr.org/releases/ITS-REST/latest">openEHR REST APIs</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.3. Status</h3>
<div class="paragraph">
<p>This specification is in the DEVELOPMENT state. The development version of this document can be found at <a href="https://specifications.openehr.org/releases/ITS-REST/latest/smart_app_launch.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/ITS-REST/latest/smart_app_launch.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.4. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.openehr.org/c/specifications/its" target="_blank" rel="noopener">openEHR ITS forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/ITS-REST/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/ITS-REST/history" target="_blank" rel="noopener">ITS-REST component Change Request tracker</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_background"><a class="anchor" href="#_background"></a>2.1. Background</h3>
<div class="paragraph">
<p><strong>SMART</strong> stands for “Substitutable Medical Applications and Reusable Technologies”, a healthcare standard through which applications can access clinical information through a data store. It was initially proposed by <a href="https://smarthealthit.org/" target="_blank" rel="noopener">SMART Health IT</a> project and was later on specified as <a href="https://www.hl7.org/fhir/smart-app-launch/" target="_blank" rel="noopener">SMART on FHIR</a>, a protocol which works on top of <a href="https://www.hl7.org/fhir" target="_blank" rel="noopener">FHIR APIs</a>. The specification builds on <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">OAuth2</a> and <a href="https://openid.net/specs/openid-connect-core-1_0.html#Authentication" target="_blank" rel="noopener">OIDC Core</a> which are industry standards for authentication and authorization, and allows 3rd party apps to seamlessly work with any (FHIR) EHR system that implements the protocol.</p>
</div>
<div class="paragraph">
<p>The <strong>SMART on openEHR</strong> specification aims to be backward compatible with <em>SMART on FHIR</em> while making this protocol work for vendors utilizing also openEHR REST APIs and more.</p>
</div>
</div>
<div class="sect2">
<h3 id="_glossary"><a class="anchor" href="#_glossary"></a>2.2. Glossary</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vendor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entity that provides software to end-users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software developed by the vendor or an external entity designed to work with the CDR and/or Launcher built by the vendor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A system comprising of an openEHR Clinical Data Repository and a FHIR Server, providing openEHR and FHIR REST APIs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2 Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An authentication server that provides APIs consistent with the OAuth2 specification and will be extended to the SMART protocol that will be described in this document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Launcher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User facing software built by the CDR vendor that serves to launch other applications within a context of a patient or practitioner. This can be the main “EHR system” or a separate application.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_why_smart_on_openehr"><a class="anchor" href="#_why_smart_on_openehr"></a>2.3. Why SMART on openEHR?</h3>
<div class="paragraph">
<p>A popular vision nowadays is considering that a single software vendor cannot provide all the necessary tools and software for a healthcare system while still maintaining a high level of quality and a low cost of ownership. Independent vendors who focus on a specific topic or problem to be solved may have an edge over monolithic "suites" of software that try to do everything.</p>
</div>
<div class="paragraph">
<p>In practice, this requires applications from multiple vendors working together to provide a complete solution, often named "best-of-breed". This is currently done is by long, tedious manual "integration" phase where the vendors work together to make their software work together - a very expensive process and is a major barrier to entry for new vendors.</p>
</div>
<div class="paragraph">
<p>The SMART specification aims to solve this problem by providing a standard way for systems and applications to work together, as it defines a contract between the <em>Application vendor</em> and the <em>CDR vendor</em>. This contract covers the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>Application</em> should have the ability to be hosted on a domain owned by the <em>Application vendor</em></p>
</li>
<li>
<p>The <em>CDR</em> should have the ability to be hosted on a domain owned by the <em>CDR vendor</em></p>
</li>
<li>
<p>The <em>Application</em> needs a way to discovery API services offered by the <em>CDR</em></p>
</li>
<li>
<p>The <em>Application</em> needs a way to authenticate with the <em>CDR</em> to access the APIs offered by the <em>CDR</em></p>
</li>
<li>
<p>The <em>Application</em> needs a way to understand the "context" their app should open in by letting the <em>CDR</em> handle EHR and Episode selection</p>
</li>
<li>
<p>The <em>Application</em> needs a way to embed within the <em>CDR</em>'s user interface while maintaining the "context" to provide a seamless user experience</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://specifications.openehr.org/releases/RM/latest/index" target="_blank" rel="noopener">openEHR Reference Model</a> and <a href="https://specifications.openehr.org/releases/ITS-REST/latest" target="_blank" rel="noopener">openEHR REST APIs</a> provide a foundation for interoperable applications. For applications to be truly portable between systems and vendors, there is a requirement for a uniform <em>authentication</em> and <em>authorization</em>.
Many of such applications also function in the <em>context</em> of a single EHR, and potentially of a single Episode. Selection of this <em>context</em> also becomes essential before lunching.</p>
</div>
<div class="paragraph">
<p>The <strong>SMART on openEHR</strong> specification is meant to provide a framework for the following aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_application_registration">Application Registration</a></p>
</li>
<li>
<p><a href="#_service_discovery">Service Discovery</a></p>
</li>
<li>
<p><a href="#_authentication_authorization_and_scopes">Authentication and Authorization</a></p>
</li>
<li>
<p><a href="#_context_selection">Context Selection</a></p>
</li>
<li>
<p><a href="#_embedded_iframe_launch">Embedded iFrame Launch</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_registration"><a class="anchor" href="#_application_registration"></a>3. Application Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <em>Application</em> needs to first register itself with the CDR that it needs to work with. This process involves the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Application registers with the CDR by providing the appropriate, ID, OAuth2 Scopes, Launch Contexts, Domains, Redirect URLs etc.</p>
</li>
<li>
<p>The Application obtains credentials like the Client ID, Client Secret from the CDR for authentication and authorization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While this process could be formalised and automated using protocols like OAuth2 Dynamic Client Registration in the future, the current recommendation is to do this out-of-band in a way that makes sense for the Application Vendor and the CDR Vendor. For example, the CDR vendor could offer a Registration Page that Application Vendors could use to register their applications, and can have an approval and audit mechanism before applications are registered.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_discovery"><a class="anchor" href="#_service_discovery"></a>4. Service Discovery</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_background_2"><a class="anchor" href="#_background_2"></a>4.1. Background</h3>
<div class="paragraph">
<p>A <em>CDR</em> usually has multiple endpoints of interest. Some of these can include the OAuth2&#8217;s <code>.well-known</code> endpoints like <em>Token</em> and <em>Authentication</em> endpoints. The <em>Application</em> may also be interested in other APIs like the openEHR REST API, vendor&#8217;s proprietary APIs, DICOMWeb APIs, FHIR APIs to name a few.</p>
</div>
<div class="paragraph">
<p>The SMART Service Discovery builds on the <code>.well-known/smart-configuration</code> of the <em>SMART on FHIR</em> specification and enables a vendor to advertise multiple services alongside the <em>.well-known</em> OAuth2 endpoints for authentication.</p>
</div>
<div class="paragraph">
<p>Given a vendor&#8217;s base URL of <code><a href="https://ehr.example.com" class="bare">https://ehr.example.com</a></code>, the SMART Configuration endpoint SHOULD be available at <code><a href="https://ehr.example.com/.well-known/smart-configuration" class="bare">https://ehr.example.com/.well-known/smart-configuration</a></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The vendor can choose to make <code><a href="https://ehr.example.com" class="bare">https://ehr.example.com</a></code> the base URL of their FHIR endpoint if they want to maintain backward compatibility for <em>SMART on FHIR</em> application, since these apps assume the vendor&#8217;s base URL is always the FHIR server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example of a response from <code>/.well-known/smart-configuration</code> will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;issuer&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;jwks_uri&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com/.well-known/jwks.json&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;authorization_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com/auth/authorize&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;token_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com/auth/token&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;services&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;org.openehr.rest&quot;</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://ehr.example.com/openehr/rest/v1&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;The openEHR official API baseUrl&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/openehr/docs&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;openapi&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/openehr/rest/v1/openapi.json&quot;</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;org.fhir.rest&quot;</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://ehr.example.com/&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;The FHIR API baseUrl&quot;</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;com.amazon.aws.s3.rest&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://s3.example.com/storage&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/s3/docs&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;openapi&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://example.com/s3/openapi.json&quot;</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;com.example.demographics&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;baseUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;https://demographics.example.com/rest&quot;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">},</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;token_endpoint_auth_methods_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client_secret_basic&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;private_key_jwt&quot;</span>
<span class="tok-w">  </span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;grant_types_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;authorization_code&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client_credentials&quot;</span>
<span class="tok-w">  </span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;registration_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com/auth/register&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;scopes_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s2">&quot;openid&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;profile&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;launch&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;launch/patient&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;patient/*.rs&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;user/*.rs&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;offline_access&quot;</span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;response_types_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s2">&quot;code&quot;</span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;management_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com/user/manage&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;introspection_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com/user/introspect&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;revocation_endpoint&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://ehr.example.com/user/revoke&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code_challenge_methods_supported&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s2">&quot;S256&quot;</span><span class="tok-p">],</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;capabilities&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;launch-ehr&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;permission-patient&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;permission-v2&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client-public&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;client-confidential-symmetric&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;context-ehr-patient&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;sso-openid-connect&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;launch-openehr-ehr&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-s2">&quot;openehr-permission-v1&quot;</span><span class="tok-p">,</span>
<span class="tok-w">	</span><span class="tok-s2">&quot;launch-base64-json&quot;</span>
<span class="tok-w">  </span><span class="tok-p">]</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_endpoints"><a class="anchor" href="#_authentication_endpoints"></a>4.2. Authentication endpoints</h3>
<div class="paragraph">
<p>The following should be exactly the same as in the OAuth2 + OIDC protocol&#8217;s <code>.well-known/openid-configuration</code> as per <a href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_blank" rel="noopener">OpenID Connect Discovery 1.0</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isuer</code></p>
</li>
<li>
<p><code>jwks_uri</code></p>
</li>
<li>
<p><code>authorization_endpoint</code></p>
</li>
<li>
<p><code>token_endpoint</code></p>
</li>
<li>
<p><code>token_endpoint_auth_methods_supported</code></p>
</li>
<li>
<p><code>grant_types_supported</code></p>
</li>
<li>
<p><code>scopes_supported</code></p>
</li>
<li>
<p><code>response_types_supported</code></p>
</li>
<li>
<p><code>introspection_endpoint</code></p>
</li>
<li>
<p><code>revocation_endpoint</code></p>
</li>
<li>
<p><code>code_challenge_methods_supported</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services"><a class="anchor" href="#_services"></a>4.3. Services</h3>
<div class="paragraph">
<p>The <code>services</code> section allows the application to discover the APIs of all services that can be used along with a description and documentation. The following are identified as known services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.openehr.rest</code>: The base URL of the openEHR REST API</p>
</li>
<li>
<p><code>org.fhir.rest</code>: The base URL of the FHIR REST API</p>
</li>
<li>
<p><code>org.dicomstandard.dicomweb.rest</code>: The base URL of the DICOMWeb REST API</p>
</li>
<li>
<p><code>com.amazon.aws.s3.rest</code>: The base URL of an AWS S3 compatible REST API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the vendor may decide to add additional services to this list. The key of each service should then follow the inverse domain naming convention using a domain the vendor has control over. For example, <code>com.example.demographics</code> is a proprietary service that is not part of the openEHR, FHIR or DICOMWeb specifications.</p>
</div>
<div class="paragraph">
<p>The body of the service should include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>baseUrl</code>: [REQUIRED] The base URL of the service</p>
</li>
<li>
<p><code>description</code>: [OPTIONAL] A description of the service</p>
</li>
<li>
<p><code>documentation</code>: [OPTIONAL] A URL to the documentation of the service</p>
</li>
<li>
<p><code>openapi</code>: [OPTIONAL] A URL to the OpenAPI specification of the service</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_capabilities"><a class="anchor" href="#_capabilities"></a>4.4. Capabilities</h3>
<div class="paragraph">
<p>The <code>capabilities</code> section is an array that should include all relevant capabilities as per SMART. The following additional capabilities should indicate the ability to launch using openEHR artefacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>launch-openehr-ehr</code> - support to select an EHR context within openEHR returned as the "ehr" parameter in a token.</p>
</li>
<li>
<p><code>launch-openehr-episode</code> - support to launch and select an Episode context returned as the "episode" parameter in a token.</p>
</li>
<li>
<p><code>openehr-permission-v1</code> - support for the scope and authorization scheme described below for openEHR REST APIs</p>
</li>
<li>
<p><code>launch-base64-json</code> - support for the "launch" URL parameter being a base64 encoded JSON of the context.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication_authorization_and_scopes"><a class="anchor" href="#_authentication_authorization_and_scopes"></a>5. Authentication, Authorization and Scopes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_authentication"><a class="anchor" href="#_authentication"></a>5.1. Authentication</h3>
<div class="paragraph">
<p>The <em>Application</em> can authenticate with the <em>CDR</em> using standard <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">OAuth2.0 protocol</a>.</p>
</div>
<div class="paragraph">
<p>The <em>CDR</em> SHOULD support at least the following basic flows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.1" target="_blank" rel="noopener">Authorization Code Flow</a> with <a href="https://tools.ietf.org/html/rfc7636" target="_blank" rel="noopener">PKCE</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.1" target="_blank" rel="noopener">Authorization Code Flow</a> with client secret</p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.4" target="_blank" rel="noopener">Client Credentials Flow</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc7515" target="_blank" rel="noopener">JWS Assertion Flow</a> (RFC7515)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The supported flows SHOULD be advertised in the <code>.well-known/smart-configuration</code> endpoint.</p>
</div>
<div class="paragraph">
<p>The recommended authentication flow depends on the type of the application. Here we make a distinction between the different kinds of applications based on whether it can hold a client secret. The following types of applications are considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Confidential Clients</strong>: Have the ability to hold a client secret. This includes web applications running on a server and backend applications.</p>
</li>
<li>
<p><strong>Public Clients</strong>: Do not have the ability to hold a client secret. This includes mobile applications and single page web applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The distinction can also be made on the basis of the user interaction. The following types of applications are considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Patient facing</strong>: The patient is the direct user of this application, or is opened up by a practitioner within the context of a patient. Can also be opened within the context of an episode, but is optional.</p>
</li>
<li>
<p><strong>Practitioner facing</strong>: The practitioner is the direct user of this application. Can be opened up within the context of a patient, or episode, but is not mandatory.</p>
</li>
<li>
<p><strong>Backend</strong>: The application is not directly used by a user, but is used by other applications or services in the background.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended that Patient and Practitioner facing applications use one of the Authorization Code Flows to obtain necessary user information and context. Confidential clients can use the Authorization Code Flow with PKCE or the Authorization Code Flow with Client Secret. Public clients SHOULD always use the Authorization Code Flow with PKCE. Backend applications SHOULD always use confidential clients and use the JWS Assertion Flow or the Client Credentials Flow.</p>
</div>
<div class="paragraph">
<p>The following table shows the recommended flow for a few example application.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Application Example</th>
<th class="tableblock halign-left valign-top">Client Type</th>
<th class="tableblock halign-left valign-top">User interaction type</th>
<th class="tableblock halign-left valign-top">Recommended Flow</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Page Web Application for a Patient Portal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patient facing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Code Flow with PKCE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobile Application for tracking heart rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patient facing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Code Flow with PKCE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Application with Backend for cardiology management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confidential client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Practitioner facing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Code Flow with PKCE or Authorization Code Flow with Client Secret</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Realtime alert system for hospital</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confidential client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backend</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWS Assertion Flow or Client Credentials Flow</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following flows are considered legacy and SHOULD NOT be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.2" target="_blank" rel="noopener">Implicit Flow</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.3" target="_blank" rel="noopener">Resource Owner Password Credentials</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_smart_authorization_flow"><a class="anchor" href="#_smart_authorization_flow"></a>5.2. SMART Authorization Flow</h3>
<div class="paragraph">
<p>Both Patient facing and Practitioner facing application have special requirements that cannot be fulfilled by standard OAuth2. These applications can be opened in one of two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Standalone launch: The URL of the application is opened directly be the end user. Eg: <code><a href="https://myapp.com" class="bare">https://myapp.com</a></code>. The application decides which CDR url to use based on the user&#8217;s selection.</p>
</li>
<li>
<p>Embedded EHR launch: The application is embedded within an EHR using an iFrame. Additional parameters are passed to the application to indicate the CDR to use, and the launch context. Eg: <code><a href="https://myapp.com?launch=123&amp;iss=https://cdr.com" class="bare">https://myapp.com?launch=123&amp;iss=https://cdr.com</a></code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Authorization Code Flow as defined in OAuth2 is a 2-step process where:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client first requests an authorization code from the authorization server by redirecting the user to the <code>authorization_endpoint</code>.</p>
</li>
<li>
<p>Exchanges the authorization code for an access token by using the <code>token_endpoint</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The SMART protocol makes the following modifications to the Authorization Code Flow to enhance it for the use case of standalone and embedded launch:</p>
</div>
<div class="sect3">
<h4 id="_context_selection"><a class="anchor" href="#_context_selection"></a>5.2.1. Context Selection</h4>
<div class="paragraph">
<p>In the Standalone launch, application can request a CDR for context selection. Most patient and practitioner facing application, along with the initial login and consent page, will also require the CDR to send additional context like the patient ID, Episode ID to the application. This context data can be used to pre-populate the application with the correct data.</p>
</div>
<div class="paragraph">
<p>The CDR can do this by automatically inferring the context based on the user logged in or <code>launch</code> token (in case of Embedded iFrame Launch). The CDR can provide a screen right after the consent page to select the context in case of ambiguity.</p>
</div>
<div class="paragraph">
<p>The <em>Application</em> can request the <em>CDR</em> for openEHR related context selection by passing the following special scopes in the authorization request:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>launch/patient</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When launching outside the EHR, ask for the openEHR EHR ID to be selected.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The context data populated by the EHR is returned in the token response along with the <code>id_token</code> and <code>access_token</code>. The following additional parameters are added to the token response:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ehrId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UUID (string) of the openEHR EHR associated with the FHIR Patient resource in the launch.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The application can make use of these parameters to render the correct information to the user.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The launch scopes and token attributes from SMART on FHIR can also be combined here for backward compatibility. All the parameters covered by SMART on FHIR is not covered here.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_embedded_iframe_launch"><a class="anchor" href="#_embedded_iframe_launch"></a>5.2.2. Embedded iFrame Launch</h4>
<div class="paragraph">
<p>Most practitioner facing, as well as some patient facing applications will have to be embedded within the user&#8217;s workflow by using an iFrame. The CDR can automatically select the correct context for the application by passing the <code>launch</code> parameter to the application&#8217;s url. The CDR should also provide the <code>iss</code> parameter to indicate the CDR for the application to use.</p>
</div>
<div class="paragraph">
<p>The application will be opened on a URL like follows: <code><a href="https://myapp.com?launch=123&amp;iss=https://cdr.com" class="bare">https://myapp.com?launch=123&amp;iss=https://cdr.com</a></code>.</p>
</div>
<div class="paragraph">
<p>The application can then use the <code>iss</code> parameter to obtain the CDR configuration from the <code>.well-known/smart-configuration</code> endpoint. It then uses the <code>authorization_endpoint</code> to start the Authorization Code Flow. The <code>launch</code> parameter is passed along to the authorization request.</p>
</div>
<div class="paragraph">
<p>The following scope is also mandatory while passing the <code>launch</code> parameter:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>launch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to obtain launch context when app is launched from an EHR using launch parameter. This should be accompanied by an additional <code>launch</code> parameter in the authorization request.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is <strong>RECOMMENDED</strong> that the <code>launch</code> token be a base64 encoded JSON object containing the context attributes like: <code>ehrId</code>, along with other attributes for internal purposes. The application can use this information to pre-populate the application without initiating an authorization request if it is already authenticated. This will enable a seamless experience for the user when switching between patients while using the application within an iFrame. This capability can be advertised by adding the <code>launch-base64-json</code> to the <code>capabilities</code> parameter of the <code>/.well-known/smart-configuration</code> response.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scopes_for_openehr_rest_api"><a class="anchor" href="#_scopes_for_openehr_rest_api"></a>5.3. Scopes for openEHR REST API</h3>
<div class="paragraph">
<p>The <em>Application</em> can request access to the <em>CDR</em> resources using the OAuth2.0 scopes. A complete scope is represented using:</p>
</div>
<div class="paragraph">
<p><code>&lt;compartment&gt;/&lt;resource&gt;.&lt;permission&gt;</code></p>
</div>
<div class="paragraph">
<p>The scopes are based on 3 different compartments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>patient/*</code>: These scopes are used when the EHR ID is present in the context. Only access to resources in the compartment of the EHR ID is allowed.</p>
</li>
<li>
<p><code>user/*</code>: These scopes are used when the user is identified by the CDR. It is usually a practitioner or an administrator. Only access to resources that the user would usually have access to is allowed.</p>
</li>
<li>
<p><code>system/*</code>: These scopes are used when the user is not available and the application is a backend confidential application. These scopes are obtained in advance while registering the application and provides unrestricted access to resources in the CDR.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following resource expressions are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>template-&lt;templateId&gt;</code>: Templates which match the &lt;templateId&gt; expression.</p>
</li>
<li>
<p><code>composition-&lt;templateId&gt;</code>: Compositions of the templates which match the &lt;templateId&gt; expression.</p>
</li>
<li>
<p><code>aql-&lt;queryName&gt;</code>: AQL Queries that match the &lt;queryName&gt; expression. If the &lt;queryName&gt; is <code>*</code>, then all queries as well as ad-hoc queries are allowed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&lt;templateId&gt;</code> in the above definition follows the blob pattern matching delimited by a <code>.</code> period. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MyHospital.Template.v0</code> - Matches only <code>MyHospital.Template.v0</code></p>
</li>
<li>
<p><code>*.Template.v0</code> - Matches <code>MyHospital.Template.v0</code> and <code>OtherHospital.Template.v0</code></p>
</li>
<li>
<p><code>MyHospital.**</code> - Matches <code>MyHospital.Template.v0</code>, <code>MyHospital.Template.v2</code> and <code>MyHospital.OtherTemplate.v0</code></p>
</li>
<li>
<p><code>*</code> - Matches all templates in the system</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&lt;queryName&gt;</code> in the above definition follows the blob pattern matching delimited by <code>.</code> a period. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.openehr::compositions</code> - Matches only <code>org.openehr::compositions</code></p>
</li>
<li>
<p><code>org.openehr::*</code> - Matches <code>org.openehr::compositions</code> and <code>org.openehr::bloodpressure</code></p>
</li>
<li>
<p><code>org.openehr::**</code> - Matches <code>org.openehr::compositions</code>, <code>org.openehr::bloodpressure</code>, <code>org.openehr::bloodpressure.v1</code></p>
</li>
<li>
<p><code>*</code> - Matches all queries and ad-hoc queries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following permission expressions are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c</code>: The ability to create a resource.</p>
</li>
<li>
<p><code>r</code>: The ability to read a resource.</p>
</li>
<li>
<p><code>u</code>: The ability to update a resource.</p>
</li>
<li>
<p><code>d</code>: The ability to delete a resource.</p>
</li>
<li>
<p><code>s</code>: The ability to search a resource. In case of <code>aql-&lt;queryName&gt;</code> scope, this means the ability to execute the query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table is a maximal representation of the scopes made possible in different compartment/resource.permission combinations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patient/composition-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete compositions of <code>&lt;templateId&gt;</code> that are within the EHR of the patient in context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user/composition-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete compositions of <code>&lt;templateId&gt;</code> that are within the EHRs the logged-in user has access to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system/composition-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete compositions of <code>&lt;templateId&gt;</code> of all EHRs in the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patient/template-&lt;templateId&gt;.r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to read a template with <code>&lt;templateId&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user/template-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create and read a template with <code>&lt;templateId&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system/template-&lt;templateId&gt;.crud</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update and delete a template with <code>&lt;templateId&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patient/aql-&lt;queryName&gt;.rs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to read and execute AQL with <code>&lt;queryName&gt;</code> on EHR ID of the patient in context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user/aql-&lt;queryName&gt;.cruds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update, delete and execute AQL with &lt;queryName&gt; on EHR IDs that the logged-in user has access to. If <code>&lt;queryName&gt;</code> is equal to the wildcard *, this scope will allow the ad-hoc query endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system/aql-&lt;queryName&gt;.cruds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission to create, read, update, delete and execute AQL with <code>&lt;queryName&gt;</code>. If <code>&lt;queryName&gt;</code> is equal to the wildcard *, this scope will allow the ad-hoc query endpoint.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-08-21 14:37:30 UTC
</div>
</div>
</body>
</html>